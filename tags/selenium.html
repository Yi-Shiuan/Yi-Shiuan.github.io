<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Bruno&#x27;s Notes</title><meta name="description" content="Bruno 的技術筆記"/><meta property="og:type" content="website"/><meta property="og:title" content="Bruno&#x27;s Notes"/><meta property="og:description" content="Bruno 的技術筆記"/><meta property="og:site_name" content="Bruno&#x27;s Notes"/><meta property="twitter:card" content="summary"/><meta property="twitter:creator" content="Bruno&#x27;s Notes"/><meta property="twitter:title" content="Bruno&#x27;s Notes"/><meta property="twitter:description" content="Bruno 的技術筆記"/><meta name="next-head-count" content="12"/><link rel="preload" href="/_next/static/css/b6fdcd916ca35284.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b6fdcd916ca35284.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-5752944655d749a0.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-fbf97c092d1ca569.js" defer=""></script><script src="/_next/static/chunks/pages/_app-652f16ac644b9842.js" defer=""></script><script src="/_next/static/chunks/770-0b2a606760df5bd6.js" defer=""></script><script src="/_next/static/chunks/pages/tags/%5Btag%5D-a6eb3f15996395ee.js" defer=""></script><script src="/_next/static/eLlB-DKNmgsWZefxJTpN8/_buildManifest.js" defer=""></script><script src="/_next/static/eLlB-DKNmgsWZefxJTpN8/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="g-layout-boxed g-bgi-v8"><main class="container"><div class="row justify-content-between"><section class="col-lg-3 order-lg-1 g-mb-80-lg g-pt-100--lg"><div class="u-header u-header--side c-navbar-side-left animate__animated animate__fast"><div class="u-header__section-container g-bg-white"><div class="u-header__section u-header__section--light"><nav class="navbar navbar-expand-lg container g-px-17"><div class="w-100"><div class="justify-content-between w-100 d-flex d-lg-block"><a class="navbar-brand g-mb-60--lg" href="/">Bruno&#x27;s Notes</a><button class="navbar-toggler btn btn-md g-line-height-1 g-brd-none g-pa-0 collapsed" type="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-lg g-mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg></button></div><div class="collapse navbar-collapse align-items-center flex-sm-row w-100 g-mt-20 g-mt-0--lg g-mb-40"><ul class="navbar-nav ml-auto text-uppercase g-font-weight-600 u-sub-menu-v1"><a class="d-block u-link-v5 g-color-gray-dark-v4 rounded g-py-8 g-color-purple--hover" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="house" class="svg-inline--fa fa-house g-mr-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="14.61" height="12.98"><path fill="currentColor" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"></path></svg>首頁</a><a class="d-block u-link-v5 g-color-gray-dark-v4 rounded g-py-8 g-color-purple--hover" href="/about"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user" class="svg-inline--fa fa-user g-mr-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="14.61" height="12.98"><path fill="currentColor" d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0S96 57.3 96 128s57.3 128 128 128zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"></path></svg>關於我</a><a class="d-block u-link-v5 g-color-gray-dark-v4 rounded g-py-8 g-color-purple--hover" href="https://study4.tw" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="leaf" class="svg-inline--fa fa-leaf g-mr-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14.61" height="12.98"><path fill="currentColor" d="M272 96c-78.6 0-145.1 51.5-167.7 122.5c33.6-17 71.5-26.5 111.7-26.5h88c8.8 0 16 7.2 16 16s-7.2 16-16 16H288 216s0 0 0 0c-16.6 0-32.7 1.9-48.3 5.4c-25.9 5.9-49.9 16.4-71.4 30.7c0 0 0 0 0 0C38.3 298.8 0 364.9 0 440v16c0 13.3 10.7 24 24 24s24-10.7 24-24V440c0-48.7 20.7-92.5 53.8-123.2C121.6 392.3 190.3 448 272 448l1 0c132.1-.7 239-130.9 239-291.4c0-42.6-7.5-83.1-21.1-119.6c-2.6-6.9-12.7-6.6-16.2-.1C455.9 72.1 418.7 96 376 96L272 96z"></path></svg>Study4.TW</a><a class="d-block u-link-v5 g-color-gray-dark-v4 rounded g-py-8 g-color-purple--hover" href="https://www.facebook.com/amour99520" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook g-mr-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14.61" height="12.98"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg>Facebook</a><a class="d-block u-link-v5 g-color-gray-dark-v4 rounded g-py-8 g-color-purple--hover" href="https://github.com/yi-shiuan" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github g-mr-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" width="14.61" height="12.98"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>Github</a><li class="nav-item"><hr class="g-brd-gray-light-v4"/></li><li class="nav-item g-my-5"><h3 class="h5 g-color-black g-font-weight-600 mb-4">系列文章</h3><ul class="u-list-inline mb-0 text-uppercase"></ul></li></ul></div></div></nav></div></div></div></section><section class="col-lg-9 order-lg-5 g-mb-80 g-px-0"><section class="g-mb-80"><img alt="background image" src="/_next/static/media/background.f22cfc26.jpg" width="9750" height="6504" decoding="async" data-nimg="future" class="img-fluid g-height-250" loading="lazy" style="color:transparent;object-fit:cover;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http%3A//www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 8 5&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;1&#x27;/%3E%3CfeComponentTransfer%3E%3CfeFuncA type=&#x27;discrete&#x27; tableValues=&#x27;1 1&#x27;/%3E%3C/feComponentTransfer%3E%%3C/filter%3E%3Cimage filter=&#x27;url(%23b)&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; height=&#x27;100%25&#x27; width=&#x27;100%25&#x27; href=&#x27;data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAFAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAdEAABBAIDAAAAAAAAAAAAAAABAAIDBQYREhOR/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAaEQACAgMAAAAAAAAAAAAAAAABAgADERMh/9oADAMBAAIRAxEAPwCTxvLnU7esV0E8JHExvcfdoiINNbHJWTsdeAz/2Q==&#x27;/%3E%3C/svg%3E&quot;)"/></section><section class="col-12 g-px-15"><article class="g-mb-100 g-px-18"><div class="g-mb-30"><span class="d-block g-color-gray-dark-v4 g-font-weight-700 g-font-size-12 text-uppercase mb-2">07 Apr 2021</span><h2 class="h4 g-color-black g-front-weight-600 mb-3"><a class="u-link-v5 g-color-black g-color-purple--hover" href="/tags/2021/04/07/selenium-grid-4">Selenium Grid 4 體驗</a></h2><p class="g-color-gray-dark-v4 g-line-height-18">最近在處理系統交接並且升級相關的系統發現了Selenium Grid出了第四版現正Beta時讓我躍躍欲試， 以前Selenium Grid 3.x版本的時候UI說真的不怎麼樣，做了Selenium Grid 4的時候樣式跟整個畫面的設計全改了。 整個畫面看起來舒服了不少，但相關的東西也改了不少讓我一開始做測試的時候跌了不少次</p></div><ul class="list-inline g-brd-y g-brd-gray-light-v3 g-font-size-13 g-py-13 mb-0 d-flex justify-content-between align-items-center"><li class="list-inline-item g-color-gray-dark-v4 g-hidden-sm-down"><span class="d-line-block g-color-gray-dark-v4 g-px-15 g-py-5"><img alt="Bruno Jan" src="/_next/static/media/myimage.85e4330e.jpg" width="3024" height="4032" decoding="async" data-nimg="future" class="g-width-20 g-height-20 rounded-circle g-mr-5" loading="lazy" style="color:transparent"/>Bruno Jan</span></li><li class="list-inline-item g-color-gray-dark-v4 float-right"><span class="d-inline-block g-color-gray-dark-v4 g-px-15 g-py-5"><span class="disqus-comment-count" data-disqus-url="https://brunojan.net/2021/04/07/selenium-grid-4">Comments</span></span><a class="d-inline-block g-color-gray-dark-v4 g-color-white--hover g-bg-purple--hover rounded g-transition-0_3 g-text-underline--none--hover g-px-15 g-py-5" href="/tags/2021/04/07/selenium-grid-4"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book-open" class="svg-inline--fa fa-book-open align-middle g-font-size-default g-mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="15.75" height="12.25"><path fill="currentColor" d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C87.5 32 35.1 48.6 9 59.9c-5.6 2.4-9 8-9 14V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V73.9c0-6.1-3.4-11.6-9-14C540.9 48.6 488.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"></path></svg>Read more</a></li></ul></article><article class="g-mb-100 g-px-18"><div class="g-mb-30"><span class="d-block g-color-gray-dark-v4 g-font-weight-700 g-font-size-12 text-uppercase mb-2">06 Sep 2020</span><h2 class="h4 g-color-black g-front-weight-600 mb-3"><a class="u-link-v5 g-color-black g-color-purple--hover" href="/tags/2020/09/06/jenkins-selenium-grid">透過Jenkins啟動Selenium Grid執行自動化測試</a></h2><p class="g-color-gray-dark-v4 g-line-height-18">QA測試當然不是只測試RD這次上線的範圍而已，而是把過去上線的功能都要在驗過一遍才能算是經過QA測試的版本，但是隨著時間的積累線上的系統越來越多 有時候QA無法透過手動的方式完成所有驗證，這時候都會導入自動畫測試selenium來協助QA做完系統的驗證，在目前我服務的公司把CD與自動化測試的部分做了整合， 當QAT部署完成後就會驅動QA的自動化驗證，但是當自動化驗證的Job越來越多一台機器已經很難在3-5分鐘內完成自動化測試怎麼辦？</p></div><ul class="list-inline g-brd-y g-brd-gray-light-v3 g-font-size-13 g-py-13 mb-0 d-flex justify-content-between align-items-center"><li class="list-inline-item g-color-gray-dark-v4 g-hidden-sm-down"><span class="d-line-block g-color-gray-dark-v4 g-px-15 g-py-5"><img alt="Bruno Jan" src="/_next/static/media/myimage.85e4330e.jpg" width="3024" height="4032" decoding="async" data-nimg="future" class="g-width-20 g-height-20 rounded-circle g-mr-5" loading="lazy" style="color:transparent"/>Bruno Jan</span></li><li class="list-inline-item g-color-gray-dark-v4 float-right"><span class="d-inline-block g-color-gray-dark-v4 g-px-15 g-py-5"><span class="disqus-comment-count" data-disqus-url="https://brunojan.net/2020/09/06/jenkins-selenium-grid">Comments</span></span><a class="d-inline-block g-color-gray-dark-v4 g-color-white--hover g-bg-purple--hover rounded g-transition-0_3 g-text-underline--none--hover g-px-15 g-py-5" href="/tags/2020/09/06/jenkins-selenium-grid"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book-open" class="svg-inline--fa fa-book-open align-middle g-font-size-default g-mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="15.75" height="12.25"><path fill="currentColor" d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C87.5 32 35.1 48.6 9 59.9c-5.6 2.4-9 8-9 14V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V73.9c0-6.1-3.4-11.6-9-14C540.9 48.6 488.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"></path></svg>Read more</a></li></ul></article></section></section></div></main></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"id":1617753600,"fileName":"selenium-grid-4","url":"2021/04/07/selenium-grid-4","title":"Selenium Grid 4 體驗","description":"最近在處理系統交接並且升級相關的系統發現了Selenium Grid出了第四版現正Beta時讓我躍躍欲試， 以前Selenium Grid 3.x版本的時候UI說真的不怎麼樣，做了Selenium Grid 4的時候樣式跟整個畫面的設計全改了。 整個畫面看起來舒服了不少，但相關的東西也改了不少讓我一開始做測試的時候跌了不少次","date":"2021-04-07T00:00:00.000Z","tags":["selenium"],"published":true,"content":"\n最近在處理系統交接並且升級相關的系統發現了Selenium Grid出了第四版現正Beta時讓我躍躍欲試，\n以前Selenium Grid 3.x版本的時候UI說真的不怎麼樣，做了Selenium Grid 4的時候樣式跟整個畫面的設計全改了。\n整個畫面看起來舒服了不少，但相關的東西也改了不少讓我一開始做測試的時候跌了不少次\n\n![selenium 4](./selenium-4.png)\n\n## Selenium 架構變更\n\n在[Selenium Component](https://www.selenium.dev/documentation/en/grid/grid_4/components_of_a_grid/)文件中就給了一張架構圖，\n跟過去只有HUB跟Node的架構有所差距，在整個部署與調整上擁有了更多彈性。你可以將HUB分散在多台的Server做部署，\n或是你可以使用經典模式的HUB將這些分散的服務集中在HUB中。\n\n新增的component有以下幾個，或者是你可以使用Hub來取代這些新的component\n- Router\n- Distributor\n- Session Map\n- New Session Queuer\n- Event Bus\n\n## Selenium Node Session的改變\n\n在以前Selenium 3.x的時候，我們可以去使用MAX_SESSIONS指定該instance的Session數量，所以在自動化測試的機器叢集中我都直接給10個讓每一個node都具有10個session，\n但這一次改版後即便你加了`SE_NODE_MAX_SESSIONS`的數量，但你的CPU數量不足時也無法產生更多的Session，新版本Node的Session數量取決於你設定的最大Session與CPU最小的那一個\n在官方的github中[這一段說明](https://github.com/SeleniumHQ/docker-selenium#increasing-session-concurrency-per-container)沒仔細看還真的很容易就給他忽略過去\n\n## Dynamic Grid的使用\n\n在新版本的Selenium Grid支援了Dynamic Grid，可以在每一次測試的時候才產生相對應的目標瀏覽器，而不用預先建置好這些瀏覽器的session\n\n在公司的Selenium的測試從集中，都採用docker的方式啟動這個對我來說可以減少在infrastructure的設定與管理\n\n以下分享我的設定，在config.toml的部分讓docker-node可以使用host的docker花了一下功夫\n\n```coffeescript\n# config.toml\n\n[docker]\n# Configs have a mapping between the Docker image to use and the capabilities that need to be matched to\n# start a container with the given image.\nconfigs = [\n    \"selenium/standalone-firefox:4.0.0-beta-3-prerelease-20210402\", \"{\\\"browserName\\\": \\\"firefox\\\"}\",\n    \"selenium/standalone-chrome:4.0.0-beta-3-prerelease-20210402\", \"{\\\"browserName\\\": \\\"chrome\\\"}\",\n    \"selenium/standalone-opera:4.0.0-beta-3-prerelease-20210402\", \"{\\\"browserName\\\": \\\"operablink\\\"}\",\n    \"selenium/standalone-edge:4.0.0-beta-3-prerelease-20210402\", \"{\\\"browserName\\\": \\\"msedge\\\"}\"\n    ]\n\n# URL for connecting to the docker daemon\n# host.docker.internal works for macOS and Windows.\n# Linux could use --net=host in the `docker run` instruction or 172.17.0.1 in the URI below.\n# To have Docker listening through tcp on macOS, install socat and run the following command\n# socat -4 TCP-LISTEN:2375,fork UNIX-CONNECT:/var/run/docker.sock\nurl = \"unix:///var/run/docker.sock\"\n# Docker imagee used for video recording\nvideo-image = \"selenium/video:ffmpeg-4.3.1-20210402\"\n\n# Uncomment the following section if you are running the node on a separate VM\n# Fill out the placeholders with appropriate values\n#[server]\n#host = \u003cip-from-node-machine\u003e\n#port = \u003cport-from-node-machine\u003e\n\n[selenium official github](https://github.com/SeleniumHQ/docker-selenium#dynamic-grid-)\n```\n\n```yml\nversion: \"3\"\nservices:\n  node-docker:\n    image: selenium/node-docker:4.0.0-beta-3-prerelease-20210402\n    user: root\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - ./config.toml:/opt/bin/config.toml\n    depends_on:\n      - hub\n    environment:\n      - SE_EVENT_BUS_HOST=hub\n      - SE_EVENT_BUS_PUBLISH_PORT=4442\n      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443\n      - SE_NODE_OVERRIDE_MAX_SESSIONS=true\n      - SE_NODE_MAX_SESSIONS=10\n  hub:\n    image: selenium/hub:4.0.0-beta-3-prerelease-20210402\n    user: root\n    ports:\n      - \"4442:4442\"\n      - \"4443:4443\"\n      - \"4444:4444\"\n    logging:\n      options:\n        max-size: 100m\n        max-file: \"1\"\n    restart: always\n```\n\n## 參考連結\n\n[Selenium document](https://www.selenium.dev/documentation/en/grid/grid_4/components_of_a_grid/)\n\n[Max sessions](https://github.com/SeleniumHQ/docker-selenium#increasing-session-concurrency-per-container)\n"},{"id":1599350400,"fileName":"jenkins-selenium-grid","url":"2020/09/06/jenkins-selenium-grid","title":"透過Jenkins啟動Selenium Grid執行自動化測試","description":"QA測試當然不是只測試RD這次上線的範圍而已，而是把過去上線的功能都要在驗過一遍才能算是經過QA測試的版本，但是隨著時間的積累線上的系統越來越多 有時候QA無法透過手動的方式完成所有驗證，這時候都會導入自動畫測試selenium來協助QA做完系統的驗證，在目前我服務的公司把CD與自動化測試的部分做了整合， 當QAT部署完成後就會驅動QA的自動化驗證，但是當自動化驗證的Job越來越多一台機器已經很難在3-5分鐘內完成自動化測試怎麼辦？","tags":["ci","selenium","jenkins"],"date":"2020-09-06T00:00:00.000Z","published":true,"content":"\n## 寫在前面\n\n一般我們上線流程都含有QA的測試階段，QA的測試與RD的開發有著很大的區別...\n\nQA測試當然不是只測試RD這次上線的範圍而已，而是把過去上線的功能都要在驗過一遍才能算是`經過QA測試`的版本，但是隨著時間的積累線上的系統越來越多\n有時候QA無法透過手動的方式完成所有驗證，這時候都會導入自動畫測試selenium來協助QA做完系統的驗證，在目前我服務的公司把CD與自動化測試的部分做了整合，\n當QAT部署完成後就會驅動QA的自動化驗證，但是當自動化驗證的Job越來越多一台機器已經很難在3-5分鐘內完成自動化測試怎麼辦？\n\n在網路上很多採用Selenium Grid的人，大多都是有一個需求是`多瀏覽器測試`，目前我們只針對chrome做測試但他也能在多台機器上為我們完成許多\n自動化測試的需求，我們則是因為許多小而美的自動化測試需要被完成\n\n\u003e 在做自動化測試的時候，我的建議是每一次只驗證一項功能是否如我們預期的運作，然後把每個工作都拆分成小的Task來完成\n\u003e\n\u003e 好處是可以透過Selenium Grid同時執行驗證減少時間成本，另外也可以避免某一個功能驗證失效，而導致後面的功能無法驗證\n\n## 架構說明\n\nJenkins我是採用Master跟Agent的方式建制的，Selenium 也適用Hub跟Node的方式建置的\n\n![jenkins 與 Selenium Grid架構圖](./jenkins-selenium.png)\n\nJenkins與Selenium均採用docker並結合docker compose起動，這邊是我撰寫的`docker-compose.yml`\n\n\u003e 在Selenium Node的部分是採用linux的版本，主要原因是雲端服務的Windows機器價格比較高，所以在部署服務上以linux為主\n\n```yaml\nversion: '3.7'\nservices:\n  master:\n    image: jenkins/jenkins:2.254\n    logging:\n      options:\n        max-size: 100m\n        max-file: \"1\"\n    restart: always\n    user: root\n    networks:\n      - net\n    ports:\n      - \"80:8080\"\n      - \"50000:50000\"\n    volumes:\n      - jenkins:/var/jenkins_home\n    environment:\n      JAVA_OPTS: -Duser.timezone=Asia/Taipei\n      JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8\n\n  test:\n    image: docker.boyu66.cc/common/selenium:4.2\n    user: root\n    logging:\n      options:\n        max-size: 100m\n        max-file: \"1\"\n    networks:\n      - net\n    depends_on:\n      - master\n    restart: always\n    volumes:\n      - test:/home/root\n    environment:\n      JAVA_OPTS: -Duser.timezone=Asia/Taipei\n    command: -url http://jenkins.boyu66.cc -workDir /home/root/agent {secretKey} TestAgent\n\n  hub:\n    image: selenium/hub:3.141.59-20200409\n    user: root\n    ports:\n      - \"4444:4444\"\n    logging:\n      options:\n        max-size: 100m\n        max-file: \"1\"\n    networks:\n      - net\n    depends_on:\n      - master\n    restart: always\n\n  chrome:\n    image: selenium/node-chrome:3.141.59-20200409\n    user: root\n    networks:\n      - net\n    volumes:\n      - /dev/shm:/dev/shm\n    depends_on:\n      - hub\n    environment:\n      NODE_MAX_INSTANCES: 10\n      NODE_APPLICATION_NAME: chrome\n      NODE_MAX_SESSION: 10\n      JAVA_OPTS: -Xmx512m\n\n\nnetworks:\n  net:\n    driver: bridge\n\nvolumes:\n  jenkins:\n  test:\n```\n\n## 建立Jenkins test agent的docker image\n\n在test agent 的dockerfile我選用了ubuntu作為base image，時區的部分設定到了台北並安裝openjdk等等的套件\n\n```dockerfile\nFROM ubuntu:18.04\n\nARG VERSION=4.2\nENV TZ='Asia/Taipei' \\\n    HOME=/home/root\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \u0026\u0026 echo $TZ \u003e /etc/timezone\n\nRUN apt-get update\nRUN apt-get install -y --no-install-recommends software-properties-common \\\n      openjdk-8-jre curl git \\\n      \u0026\u0026 apt-get clean\n\nRUN curl --create-dirs -fsSLo /usr/share/jenkins/slave.jar https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/${VERSION}/remoting-${VERSION}.jar \\\n      \u0026\u0026 chmod 755 /usr/share/jenkins \\\n      \u0026\u0026 chmod 644 /usr/share/jenkins/slave.jar\n\nWORKDIR /home/root\nUSER root\n\n## Jenkins jnlp slave ##\nCOPY jenkins-slave.sh jenkins-slave.sh\n\n\nENTRYPOINT [\"bash\", \"/home/root/jenkins-slave.sh\"]\n```\n\n最後將Jenkins的Job指定到Test Agent上執行，在Selenium的部分把webdriver的設定改道遠端的位置上就可以享受Selenium Grid了！\n\n## 參考資料\n\n[Selenium Grid 中文文黨](https://wizardforcel.gitbooks.io/selenium-doc/content/official-site/selenium-grid.html)\n"}]},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"selenium"},"buildId":"eLlB-DKNmgsWZefxJTpN8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>