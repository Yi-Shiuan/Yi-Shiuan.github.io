{"pageProps":{"posts":[{"id":1641168000,"fileName":"vulnerability-scanning-for-ssl-support-algorithm","url":"2022/01/03/vulnerability-scanning-for-ssl-support-algorithm","title":"弱點掃描-SSL加密演算法不安全的演算法","description":"最近公司資安檢查報告中被檢查出了一個關於SSL的加密連線的弱點，這個弱點是因為我們沒有把不安全的加密演算法關閉導致這個弱點的產生， 在公司的政策中線上的伺服器不能任意安裝任何程式，所以`IISCrypto`就只能放棄無法使用，所以我修改的部分是使用修改幾碼的方式進行， 由於我不太熟悉資安，修改後要如何驗證呢這些已知有問題的演算法是否已經正確的被關閉了呢？","date":"2022-01-03T00:00:00.000Z","tags":["vulnerability","ssl"],"published":true,"content":"\n最近公司資安檢查報告中被檢查出了一個關於SSL的加密連線的弱點，這個弱點是因為我們沒有把不安全的加密演算法關閉導致這個弱點的產生，\n在公司的政策中線上的伺服器不能任意安裝任何程式，所以`IISCrypto`就只能放棄無法使用，所以我修改的部分是使用修改幾碼的方式進行，\n由於我不太熟悉資安，修改後要如何驗證呢這些已知有問題的演算法是否已經正確的被關閉了呢？\n\n所以我又在網路上google找到幾個腳本，透過openssl與curl的搭配可以掃描我們的server支援了哪些SSL的加密方式，有從server site的檢查與client site的檢查。\n\n```sh\n# server side\nURL=\"https://yi-shiuan.github.io/\"\n\nciphers=$(openssl ciphers 'ALL:eNULL' | sed -e 's/:/ /g')\n\n for cipher in ${ciphers[@]}\n do\n echo -n Testing $cipher...\n result=$(echo -n | openssl s_client -cipher \"$cipher\" -connect $URL 2>&1)\n if [[ \"$result\" =~ \":error:\" ]] ; then\n   error=$(echo -n $result | cut -d':' -f6)\n   echo NO \\($error\\)\n else\n   if [[ \"$result\" =~ \"Cipher is ${cipher}\" || \"$result\" =~ \"Cipher    :\" ]] ; then\n     echo YES\n   else\n     echo UNKNOWN RESPONSE\n     echo $result\n   fi\n fi\n sleep 1\n done\n```\n\n```sh\n# client site的檢查\nURL=\"https://yi-shiuan.github.io/\"\n\nDELAY=1\nciphers=$(openssl ciphers 'ALL:eNULL' | sed -e 's/:/ /g')\n\nfor cipher in ${ciphers[@]}\ndo\n    printf -v pad %30s\n    printf \"Checking ${cipher:0:30} ... \"\n    curl -s -S -o /dev/null --no-progress-meter --tls-max 1.2 --ciphers $cipher $URL\n    if [ $? -eq 0 ]; then\n        echo OK\n    fi\ndone\n```\n\n### 參考資料\n\n[IISCrypto](https://www.nartac.com/Products/IISCrypto)\n\n[叡揚資訊](https://www.gss.com.tw/blog/set-https-connect-protocols-and-ciphers)\n\n[SSL Ciphers](https://curl.se/docs/ssl-ciphers.html)\n"},{"id":1628812800,"fileName":"azure-managed-certificate-app-service","url":"2021/08/13/azure-managed-certificate-app-service","title":"受Azure管理的免費憑證","description":"在網頁開發中，SSL憑證已經是一個不可或缺的一件事情！網路上可以找到許多免費的憑證使用，如let's encrypt、ZeroSSL 都可以幫你產生免費的憑證，唯一麻煩的事情是三個月就需要重新處理憑證問題，在雲端供應商中AWS有提供ACM微軟也有提供類似於ACM的服務， 只要你使用了這些雲端供應商就可以免費的為你產生憑證","date":"2021-08-13T00:00:00.000Z","tags":["devops","azure","ssl"],"published":true,"content":"\n在網頁開發中，SSL憑證已經是一個不可或缺的一件事情！網路上可以找到許多免費的憑證使用，如[let's encrypt](https://letsencrypt.org/zh-tw/)、\n[ZeroSSL](https://zerossl.com/)都可以幫你產生免費的憑證，唯一麻煩的事情是三個月就需要重新處理憑證問題，當然熟悉腳本處理的可以透過一些自動化的方式來處理只是需要花點時間撰寫這些腳本\n在雲端供應商中AWS有提供ACM微軟也有提供類似於ACM的服務，只要你使用了這些雲端供應商就可以免費的為你產生憑證\n\n## 設定方式\n\nAzure 坦白說UI真的不是很直覺，這也是微軟一直以來的硬傷，這個設定其實藏在我們一直看得到的地方但又不會去點他的一個按鈕\n\n再進入設定之前，必須要將自訂的domain綁在Azure app service上（或Azure functions）才能夠產生憑證，點下`Create App Service Managed Certificate`\n後只需要點選你要的Domain 就可以產生了，整個過程約3-5分鐘左右，如果有多個子網域都需要SSL的話就多點幾次\n\n![Azure 受管的 SSL](azure-managed-certificate-app-service/azure-managed-ssl.png)\n\n![Azure 產生 SSL](azure-managed-certificate-app-service/create-ssl.png)\n\n產生SSL憑證後需要到`TSL/SSL Setting`中，將剛才建立的SSL綁定到相對應的Domain name上就可以了\n\n![Azure 綁定 SSL](azure-managed-certificate-app-service/azure-ssl-binding.png)\n\n## 使用條件與限制\n\n憑證一定位有到期日期，在微軟提供的憑證中有效期間是6個月，在六個月到期後會自動的幫你renew這個憑證直到你刪除app service或azure functions等服務，\n必須要可以自訂domain name的規格才能夠產生免費的憑證(B1等級以上)\n\n> 此免費憑證有下列限制：\n>\n>  - 不支援萬用字元憑證。\n>  - 不支援以憑證指紋作為用戶端憑證的使用方式， (移除憑證指紋的) 計畫。\n>  - 不可匯出。\n>  - App Service 環境 (ASE) 上並不支援。\n>  - 與流量管理員整合的根域不支援。\n>  - 如果是 CNAME 對應網域的憑證，則 CNAME 必須直接對應至 {app-name}.azurewebsites.net 。\n>\n> [在 Azure App Service 中新增 TLS/SSL 憑證](https://docs.microsoft.com/zh-tw/azure/app-service/configure-ssl-certificate)\n"}],"allTags":{"react":4,"next.js":3,"i18n":1,"gatsby.js":1,"postgresql":1,"database":2,"dotnet":1,"aws":4,"devops":7,"prevision":6,"iot":2,"platformio":2,"arduino":2,"esp":1,"elk":3,"azure":4,"vulnerability":1,"ssl":2,"vmss":1,"cd":3,"study4":1,"dotnetconf":1,"selenium":2,"tdd":1,"jest":1,"frontend":1,"layout":1,"ec2":1,"iac":1,"terraform":1,"ci":1,"jenkins":1,"ecs":1,"ansible":1,"redis":2,"protobuf":2,"serialize":2,"deserialize":2,"pub":1,"sub":1,"notify":1}},"__N_SSG":true}